<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:of="http://omnifaces.org/functions"
                template="/WEB-INF/template.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="title">#{i18n['common.dashboard']} - #{subject.fullName}</ui:define>

    <ui:define name="head"></ui:define>
    <ui:define name="params">
        <f:metadata>
            <f:viewParam name="giftuuid" value="#{giftHome.uuid}" />
        </f:metadata>
    </ui:define>
    <ui:define name="viewname">
        <li><p:link outcome="dashboard">#{i18n['common.dashboard']} - #{subject.fullName}</p:link></li>
    </ui:define>

    <ui:define name="style" rendered="#{!request.isUserInRole('USER')}">
        <style type="text/css">
            .uuid-bg-image {
                background-image: url('#{facesContext.externalContext.requestContextPath}/images/dynamic/?uuid=#{giftHome.uuid}&amp;type=png') !important; 
                height: 360px !important;
            }

            .bg-image {
                /*background-image: url('#{not empty subject.photo ? ui.translateImageFromDB(subject.photo) : '/appsventas-web/javax.faces.resource/images/if_20.Photos_290130.png.jsf?ln=ecuador-layout'}') !important;*/ 
                background-image: url('/appsventas-web/javax.faces.resource/images/emporio-login-2019.jpg.jsf?ln=ecuador-layout') !important; 
            }
        </style>
    </ui:define>

    <ui:define name="content" rendered="#{request.isUserInRole('USER')}">
        <div class="layout-dashboard">
            <div class="ui-g">
                <div class="ui-g-12 ui-md-12 ui-lg-4">
                    <p:panel styleClass="profile">
                        <div class="bg-image">
                        </div>
                        <div class="profile-info">
                            <p:graphicImage name="#{not empty subject.photo ? ui.translateImageFromDB(subject.photo) : 'images/default-profile.jpg'}" library="ecuador-layout" class="profile-image"/>
                            <span class="name">#{subject.fullName}</span>
                            <!-- <div>
                                <i class="fa fa-briefcase"></i>
                                <span class="job">Human Resource Manager</span>
                            </div>
                            <div>
                                <i class="fa fa-location-arrow"></i>
                                <span class="location">Seattle</span>
                            </div>-->

                            <div>
                                <div class="profile-numbers">
                                    <span class="header">Regalos</span>
                                    <span class="number">#{giftHome.giftCount}</span>
                                </div>
                                <div class="profile-numbers">
                                    <span class="header">Compartidos</span>
                                    <span class="number">#{giftHome.sharedGiftCount}</span>
                                </div>
                            </div>
                        </div>
                    </p:panel>

                    <p:panel header="#{i18n['MisUltimasCompras']}" styleClass="timeline">
                        <ul>
                            <ui:repeat value="#{invoiceHome.myLastlastInvoicesByOwner}" var="entity">
                                <li>
                                    <div class="date-indicator">
                                        <span class="date">today</span>
                                        <span class="time">#{entity.createdOn}</span>
                                    </div>
                                    <div class="activity-link"></div>
                                    <i class="fa fa-circle success"></i>
                                    <div class="timeline-subject">
                                        <span class="timeline-header">#{entity.establishment.name}</span>
    <!--                                    <span class="timeline-subheader">#{ui.truncateString(entity.summary)}</span>-->
                                        <span class="timeline-subheader">#{of:abbreviate(entity.summary, settingHome.getValue("app.gift.summary.length", "28") )}</span>
                                    </div>
                                    <i class="fa fa-laptop device success"></i>
                                </li>
                            </ui:repeat>

                        </ul>
                    </p:panel>
                </div>
                <div class="ui-g-12 ui-md-12 ui-lg-8">
                    <p:panel header="Recientes regalos obtenidos" styleClass="inbox">
                        <ul>
                            <ui:repeat value="#{giftHome.giftsFromOthers}" var="entity">
                                <li>
                                    <div class="image-container">
                                        <p:graphicImage name="#{not empty entity.photo ? ui.translateImageFromDB(entity.photo) : 'images/default-profile.jpg'}"
                                                        class="profile-image"/>
                                    </div>
                                    <div class="seperator"></div>
                                    <div class="message-box">
                                        <span class="messager">#{entity.fullName}</span>
                                        <span class="time">#{entity.createdOn}</span>   
                                        <!--                                        <span class="message">It is a long established fact that a reader will be distracted by the readable content of a page when looking at its layout. The point of using Lorem Ipsum is that it has a more-or-less normal distribuâ€¦</span>       -->
                                    </div>
                                    <div class="message-status">
                                        <i class="fa fa-circle"></i>
                                        <span>#{giftHome.getCountGiftByOwner(entity)}</span>
                                    </div>    
                                </li>
                            </ui:repeat>
                        </ul>
                    </p:panel>
                    <p:panel id="gift-image-panel" header="Disfruta tu descuento directo" styleClass="profile">
                        <p:panel id="gift-image-render" visible="#{not empty giftHome.uuid}">
                            <div id="gift-image" class="bg-image uuid-bg-image">
                            </div>
                        </p:panel>
                        <p:panel id="gift-controls" rendered="#{true}" styleClass="resolution-center">
                            <p:commandButton id="print-button" value="#{i18n['get.gift']}" ajax="false" 
                                             icon="fa fa-dollar"
                                             styleClass="danger-btn"
                                             actionListener="#{giftHome.print()}"
                                             type="submit" >
                            </p:commandButton>
                        </p:panel>
                    </p:panel>
                </div>

                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <p:panel header="Upcoming Events" style="height:100%" rendered="false">
                        <p:schedule value="#{scheduleView.eventModel}"/>
                    </p:panel>
                </div>
            </div>
        </div>
    </ui:define>   

</ui:composition>